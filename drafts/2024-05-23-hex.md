---
layout: post
title: "Implementing hexagonal FFTs for fun and profit"
author: "Chris Langfield"
categories: math
tags: [math]
---

**(profits as yet unrealized)*

This post will discuss the how and a little bit of the why for my latest project, a Python package called [hexfft](https://github.com/chris-langfield/hexfft/), which implements two types of
FFT for data sampled on a hexagonal 2D grid. 

| ![Screenshot 2024-05-24 at 9 45 34 AM](https://github.com/chris-langfield/chris-langfield.github.io/assets/34426450/1773cae9-233d-44d4-96e6-4951f2960e9c) | 
|:--:| 
| *Geometry of regular hexagonal sampling* |


There are several interesting advantages to this sampling geometry. For regular hexagonal sampling, each point has 6 equidistant nearest neighbors, compared with 4 in square sampling. This scheme of tiling the 2D plane reduces grid edge effects and also for more flexible path-finding and boundary definitions. An oft-cited figure is that for a circularly bandlimited signal in the plane, 13.4% fewer samples are required to fully specify the spectrum, as a hexagonal bandregion more tightly encloses a circle than a square one. 


| ![hexvrect](https://github.com/chris-langfield/chris-langfield.github.io/assets/34426450/d7ab8815-91c3-4141-a7e3-83eee75c369b) |
| :--: |
|*Containing a circular region with hexagonal vs square sampling*|


Honeycomb-like structures are found throughout nature and science. Besides being highly aesthetically pleasing, this layout is used (or evolves naturally) when a maximally efficient coverage of the 2D plane is required. Two examples are the layout of electrodes on a probe used to detect electrical signals from neurons in the mouse brain, and the arrangement of optical fibers used to image galaxies (see below). 

| ![nautilus_bees](https://github.com/chris-langfield/chris-langfield.github.io/assets/34426450/222c61a8-4ca9-4e42-8c28-85a215448ab9) | 
| :--: |
| *Honeycomb beehive structure. Courtesy of [Nautilus magazine](https://nautil.us/why-nature-prefers-hexagons-235863/)* |

| ![retina](https://github.com/chris-langfield/chris-langfield.github.io/assets/34426450/0297b3ee-92ca-4802-b3c6-8b44dcc0e3a6) | 
| :--: |
| *Layout of cone cells in the human retina. Courtesy of Coleman, Sonya & Scotney, Bryan & Gardiner, B.. (2009). Design of Feature Extraction Operators for use on Biologically Motivated Hexagonal Image Structures. Proceedings of the 11th IAPR Conference on Machine Vision Applications, MVA 2009.* |


| ![np1 copy](https://github.com/chris-langfield/chris-langfield.github.io/assets/34426450/447371e8-5c31-4dd0-9ed2-3bb7ad218e87) | 
| :--: |
| *Neuropixels 1.0 neuroelectrophysiology probe. Courtesy of the [Allen Institute](http://portal.brain-map.org/circuits-behavior/visual-coding-neuropixels)*|


| ![space](https://github.com/chris-langfield/chris-langfield.github.io/assets/34426450/73c2f00e-c83b-45f3-8efd-19ebd79b0b9e) | 
| :--: |
| Layout of optical fibers in an astronomical detector. Courtesy of the [Sloan Digital Sky Survey](https://www.sdss4.org/instruments/manga-instrument/) |


The seminal paper on processing hexagonally sampled images is Mersereau's 1979 paper, [*The Processing of Hexagonally Sampled Two-Dimensional Signals*](https://ieeexplore.ieee.org/document/1455625). Mersereau introduces an FFT algorithm for hexagonally sampled data on a hexagon-shaped (and hexagonally periodic in the plane) region of support. This was followed up by Erhardt's 1993 [*Hexagonal Fast Fourier Transform with Rectangular output*](https://ieeexplore.ieee.org/abstract/document/205759), which extends the method to regions with rectangular periodicity. These two algorithms are implemented in the `hexfft` library. Rummelt and Birdsong discovered and patented a coordinate system in which the hexagonal Fourier kernel is [separable](https://ieeexplore.ieee.org/document/7532670). There is also work covering transforms on hexagonal (and other) lattices by the [algebraic signal processing](https://pubmed.ncbi.nlm.nih.gov/17547130/) community. A 2005 book, [Hexagonal Image Processing](https://link.springer.com/book/10.1007/1-84628-203-9), also covers the topic and introduces an array of fascinating and exotic hexagonal coordinate systems. 

As I became curious about this topic, I was surprised to find a lack of ready-to-use implementations of hexagonal FFTs. The closest I could find was [HexagDLy](https://github.com/ai4iacts/hexagdly) and the accompanying [publication](https://www.sciencedirect.com/science/article/pii/S2352711018302723) by Steppa and Holch (2019) implement convolutions on hexagonal grids with an eye towards neural network processing of astronomical data. If `hexfft`'s niche has already been filled somewhere, I can only blame my own lack of Google savvy. 

# The mathematics of the hexagonal FFT






